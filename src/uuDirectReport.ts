import { join } from "path";
import core from "./core";
import { INode } from "./interfaces";

export class UuDirectReport {
  public getUuString(topNodes: INode[], projectName: string): string {
    const template = core.readTextFile(join(__dirname, "../templates/uuString-direct.txt"));

    const libMap = new Map<string, INode>();
    for (const node of topNodes) {
      if (!libMap.has(node.library) && !node.library.startsWith("project ")) {
        libMap.set(node.library, node);
      }
    }

    const tilesLines: string[][] = [];
    const libs = libMap.values();
    for (const node of libs) {
      tilesLines.push([`<uu5string />${node.library}`, `<uu5string />${node.version}`, `<uu5string />${projectName}`, `<uu5string />`]);
    }
    tilesLines.sort((a, b) => a[0].localeCompare(b[0]) || a[1].localeCompare(b[1]));

    let content = template;
    content = content.replace("{{table}}", JSON.stringify(tilesLines, null, 2).replace(/'/g, "\\'"));
    return content;
  }
}
