import { INode } from "../src/interfaces";
import { VulnerabilityCollector } from "../src/vulnerabilityCollector";

let nodes: INode[] = [];
beforeEach(() => {
  nodes = [
    {
      library: "org.apache.camel:camel-core",
      childNodes: [
        {
          library: "org.apache.camel:camel-bean",
          childNodes: [],
          level: 2,
          version: "3.11.1",
          vulnerabilities: [
            {
              // some high
              importance: "high",
              title: "title",
              url: "http://",
              cve: "1",
              cwe: "1",
            },
            {
              // some high
              importance: "medium",
              title: "title",
              url: "http://",
              cve: "2",
              cwe: "2",
            },
          ],
        },
      ],
      level: 1,
      version: "3.11.1",
      vulnerabilities: [],
    },
    {
      library: "Enelane",
      childNodes: [
        {
          library: "uu.appg01:uu_appg01_server",
          childNodes: [
            {
              library: "org.apache.camel:camel-bean",
              childNodes: [],
              level: 2,
              version: "3.11.1",
              vulnerabilities: [
                {
                  // already existing vulnerability in other occurence
                  importance: "high",
                  title: "title",
                  url: "http://",
                  cve: "1",
                  cwe: "1",
                },
                {
                  // new vulnerability for existing vulnerability in other occurence
                  importance: "low",
                  title: "title",
                  url: "http://",
                  cve: "3",
                  cwe: "3",
                },
              ],
            },
          ],
          level: 2,
          version: "5.2.1",
          vulnerabilities: [],
        },
      ],
      level: 1,
      version: "5.0.4-SNPSHOT",
      vulnerabilities: [],
    },
    {
      library: "uu.appg01:uu_appg01_auditlog",
      childNodes: [],
      level: 1,
      version: "5.2.1",
      vulnerabilities: [],
    },
  ];
});

describe(`Vulnerability collector`, () => {
  test(`Collect`, () => {
    const collector = new VulnerabilityCollector();
    const libraries = collector.collect(nodes);
    expect(libraries).toMatchSnapshot();
  });
});
